<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Image Processor Demo</title>
<style>
 .nsImageContainer {
    position: relative;
    display: inline-block;
    margin: 0 auto;
}

.nsImageResizeEnabled img {
    display: block
}

.nsImageResizeEnabled:hover img,
.nsImageResizeEnabled:active img {
    outline: 2px dashed rgba(222,60,80,.9);
}
.nsImageResizeHandleNE,
.nsImageResizeHandleSE,
.nsImageResizeHandleNW,
.nsImageResizeHandleSW {
    position: absolute;
    display: block;
    width: 10px;
    height: 10px;
    background: rgba(222,60,80,.9);
    z-index: 999;
}

.nsImageResizeHandleNW {
    top: -5px;
    left: -5px;
    cursor: nw-resize;
}

.nsImageResizeHandleSW {
    bottom: -5px;
    left: -5px;
    cursor: sw-resize;
}

.nsImageResizeHandleNE {
    top: -5px;
    right: -5px;
    cursor: ne-resize;
}

.nsImageResizeHandleSE {
    bottom: -5px;
    right: -5px;
    cursor: se-resize;
}

.nsImageMoveContainer {
    cursor: move;
}

.nsImageHidden{
	display: none;
}

.nsImageToolbar {
    background-color: rgba(0,0,0,.5);
    color: #fff;
    height: 32px;
    position: absolute;
    max-width: 300px;
    z-index: 1000;
}

.nsImageToolbar .nsImageToolbarButton {
    background-color: transparent;
    border-width: 0;
    color: #fff;
    cursor: pointer;
    display: block;
    float: left;
    font-size: 14px;
    height: 32px;
    text-align: center;
    width: 32px;
}

.nsImageToolbar .nsImageToolbarButton:hover {
    background-color: #0074d9;
    color: #fff;
}

  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <script src="http://localhost:8080/JSLib/croppr.js"></script>
   <link rel="stylesheet" href="http://localhost:8080/JSLib/croppr.css">
</head>
<body>

	<input type="file" id="imageFileInput" accept=".jpg, .jpeg, .png" />
    <img id="preview" />
    <img src="https://unsplash.it/500/500/?random" id="image3" />
    <button onclick="uploadTestImage()">Click</button>
    
    <script src="../lib/com/org/util/nsUtil.js"></script>
    <script src="../lib/com/org/util/nsImageProcessor.js"></script>
    <script>
    document.getElementById('imageFileInput').addEventListener('change', function() {
        var file = this.files[0];
        callProcessorImage(file,null,document.getElementById("preview"),function(url,objImageProcessor){
        	/*objImageProcessor.getBase64(function(strBase64){
        		objImageProcessor.getThumbnail(strBase64, 100, 100, function(base64ThumbnailUrl) {
            		setImageUrl(document.getElementById("preview"),base64ThumbnailUrl);
            	});
        	});*/
        	setImageUrl(document.getElementById("preview"),url);
        	objImageProcessor.initializeResize();
        	objImageProcessor.initializeMove();
        	//var croppr = new Croppr('#preview');
        });
    }, false);
    
    function uploadTestImage()
    {
    	callProcessorImage(document.getElementById("image3"),"image3.png",null,function(url,objImageProcessor){
        	setImageUrl(document.getElementById("image3"),url);
        	var croppr = new Croppr('#image3');
        });
    }

    function setImageUrl(img,url) {
    	img.setAttribute('src', url);
    };
    
    function callProcessorImage(element,fileName,resizeMoveImage,uploadSuccessCallback)
    {
    	//menus:["move","resize"],
    	var setting = {element:element,uploadUrl:"../imageProcessor",image:resizeMoveImage,resizeShowOnClick:false,
    			showMenu:true,
    			uploadSuccessCallback:uploadSuccessCallback,uploadFailureCallback:function(response){
    		console.log(response);
    	},uploadProgressCallback:function(loaded,total){
    		var percentage = Math.floor((loaded / total) * 100) + '%';
    		console.log(loaded + " / " + total + " = " + percentage);
    	},validateUploadNameCallback:function(orignalFileName){
    		return (fileName ? fileName : orignalFileName);
    	}};
    	var imageProcessor = new NSImageProcessor(setting);
    	imageProcessor.uploadImage();
    }
    
    </script>

</body>
</html>
