<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Image Processor Demo</title>
	<style>
.lblLabel {
    margin-right: 1em;
    font-weight: bold;
    color: #900;
}

.lblValue {
    margin-right: 1em;
    color: black;
}

	</style>
  <link rel="stylesheet" href="../lib/css/com/org/nsImageProcessor.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
</head>
<body onload="onload()">
	
	<div style="width:500px;height:400px;overflow:hidden;border: 1px solid #000!important;float: left;">
		<input type="file" id="imageFileInput" accept=".jpg, .jpeg, .png" />
	    <img id="preview" style="width:100%;"/>
    </div>
    <!--  <img src="https://unsplash.it/500/500/?random" id="image3" crossOrigin="Anonymous" onload="uploadTestImage()"/> -->
    <!--  http://jcrop-cdn.tapmodo.com/v0.9.10/demos/demo_files/pool.jpg -->
    <div style="width:500px;height:400px;overflow:hidden;border: 1px solid #000!important;">
	    <div style="width:500px;height:380px;overflow:hidden;border: 1px solid #000!important;">
	    	<img src="http://jcrop-cdn.tapmodo.com/v0.9.10/demos/demo_files/pool.jpg" id="image3" style="width:100%;" />
	    </div>
	    <button style="float:right;" onclick="uploadTestImage()">Click</button>
	</div>
    
    <br/><br/>
    <div class="demo">
    	<div style="float: left; width: 50%;">
    		
    		<div style="width:100px;height:100px;overflow:hidden;margin-left:5px;">
				<img id="imgCropPreview" />
			</div>
			<div id="temp" style="width:500px;height:500px;">
				
			</div>
			<br/>
			<br/>
			<br/>
			<div id="temp1">
				
			</div>
		   
		    <form onsubmit="return false;">
				<label class="lblLabel">X1 <label id="lblx1" class="lblValue" />0</label></label>
				<label class="lblLabel">Y1 <label id="lbly1" class="lblValue" />0</label></label>
				<label class="lblLabel">X2 <label id="lblx2" class="lblValue" />0</label></label>
				<label class="lblLabel">Y2 <label id="lbly2" class="lblValue" />0</label></label>
				<label class="lblLabel">Width <label id="lblwidth" class="lblValue" />0</label></label>
				<label class="lblLabel">Height <label id="lblheight" class="lblValue" />0</label></label>
			</form>
			
			<div style="margin: 20px 0;">

				<span class="requiresjcrop">
					<button id="setSelect" onclick="setSelect()">setSelect</button>
					<button id="animateTo">animateTo</button>
					<button id="release">Release</button>
					<button id="disable">Disable</button>
				</span>

				<button id="enable" style="display:none;">Re-Enable</button>
				<button id="unhook">Destroy!</button>
				<button id="rehook" style="display:none;">Attach Jcrop</button>

			</div>
  		</div>
  	</div>
    
    <script src="../lib/com/org/util/nsUtil.js"></script>
    <script src="../lib/com/org/util/nsImageProcessor.js"></script>
    <script>
    function onload()
    {
    	/*var orignalImage = document.querySelector("#imgCropPreview");
    	var src = orignalImage.src;
    	orignalImage.removeAttribute('src');
    	orignalImage.removeAttribute('crossOrigin');
    	if (src.match(/^https?:\/\/|^\/\//)) {
			orignalImage.setAttribute('crossOrigin', 'anonymous');
        }
    	orignalImage.src = src;*/
    }
    
    document.getElementById('imageFileInput').addEventListener('change', function() {
        var file = this.files[0];
        callProcessorImage(file,null,document.getElementById("preview"),true,function(url,objImageProcessor){
        	/*objImageProcessor.getBase64(function(strBase64){
        		objImageProcessor.getThumbnail(strBase64, 100, 100, function(base64ThumbnailUrl) {
            		setImageUrl(document.getElementById("preview"),base64ThumbnailUrl);
            	});
        	});*/
        	setImageUrl(document.getElementById("preview"),url);
        	objImageProcessor.initializeResize();
        	objImageProcessor.initializeMove();
        	//var croppr = new Croppr('#preview');
        });
    }, false);
    var staticImageProcessor = null;
    function uploadTestImage()
    {
    	staticImageProcessor = callProcessorImage(document.getElementById("image3"),null,null,false,function(url,objImageProcessor){
					        	setImageUrl(document.getElementById("image3"),url);
					        	if(!staticImageProcessor)
					        	{
					        		staticImageProcessor = objImageProcessor;
					        	}
					        	//objImageProcessor.initializeResize();
					        	//objImageProcessor.initializeMove();
					        	//var croppr = new Croppr('#image3');
					        });
    }
    
    //document.getElementById("image3").addEventListener("load",uploadTestImage);

    function setImageUrl(img,url) {
    	img.setAttribute('src', url);
    };
    
    function callProcessorImage(element,fileName,resizeMoveImage,isUpload,uploadSuccessCallback)
    {
    	var cropSelectCallback = function(image,point)
    	{
    		//console.log(point);
    		if (point.width && point.height)
    		{
    			/*var scaleX = 100 / point.width;
    		    var scaleY = 100 / point.height;
    		    var imgPreview = document.querySelector("#imgCropPreview");
    		    imgPreview.style.width = Math.round(scaleX * image.naturalWidth) + "px";
    		    imgPreview.style.height = Math.round(scaleY * image.naturalHeight) + "px";
    		    imgPreview.style.marginLeft = (-1 * Math.round(scaleX * point.x1)) + "px";
    		    imgPreview.style.marginTop = (-1 * Math.round(scaleY * point.y1)) + "px";*/
    		    
    		    for(var key in point)
    		    {
    		    	document.querySelector("#lbl" + key).innerHTML = point[key];
    		    }
    		}
    	    
    	};
    	//menus:["move","resize"],
    	var magnifyProps = {resultElement:"temp"};
    	var setting = {element:element,uploadUrl:"../imageProcessor",image:resizeMoveImage,resizeShowOnClick:false,
    			showMenu:true,resizeMeasurement:true,resizeMaxWidth:9000,resizeMaxHeight:9000,cropPreviewImages:["imgCropPreview"],
    			magnifyProps:magnifyProps,
    			uploadSuccessCallback:uploadSuccessCallback,uploadFailureCallback:function(response){
    		console.log(response);
    	},uploadProgressCallback:function(loaded,total){
    		var percentage = Math.floor((loaded / total) * 100) + '%';
    		console.log(loaded + " / " + total + " = " + percentage);
    	},validateUploadNameCallback:function(orignalFileName){
    		return (fileName ? fileName : orignalFileName);
    	},cropSelectingCallback:cropSelectCallback,cropSelectedCallback:cropSelectCallback};
    	var imageProcessor = new NSImageProcessor(setting);
    	staticImageProcessor = imageProcessor;
    	if(isUpload)
    	{
    		imageProcessor.uploadImage();
    	}
    	return imageProcessor;
    }
    
    function setSelect()
    {
    	var point = {x1:345,y1:174,x2:420,y2:285};
    	staticImageProcessor.cropSetSelect(point);
    }
    
    </script>

</body>
</html>

enableAnimation:false,

.nsImageContainer {
    position: relative;
    display: inline-block;
    margin: 0 auto;
    /* for zooming*/
    overflow: hidden;
}

.nsImageResizeEnabled img {
    display: block
}

.nsImageResizeEnabled:hover img,
.nsImageResizeEnabled:active img {
    outline: 2px dashed rgba(222,60,80,.9);
}
.nsImageResizeHandleNE,
.nsImageResizeHandleSE,
.nsImageResizeHandleNW,
.nsImageResizeHandleSW {
    position: absolute;
    display: block;
    width: 10px;
    height: 10px;
    background: rgba(222,60,80,.9);
    z-index: 999;
}

.nsImageResizeHandleNW {
    top: -5px;
    left: -5px;
    cursor: nw-resize;
}

.nsImageResizeHandleSW {
    bottom: -5px;
    left: -5px;
    cursor: sw-resize;
}

.nsImageResizeHandleNE {
    top: -5px;
    right: -5px;
    cursor: ne-resize;
}

.nsImageResizeHandleSE {
    bottom: -5px;
    right: -5px;
    cursor: se-resize;
}

.nsImageMoveContainer {
    cursor: move;
}

.nsImageTransition {
    -webkit-transition: all .3s;
    transition: all .3s;
}

.nsImageHidden{
	display: none;
}

.nsImageToolbar {
    background-color: rgba(0,0,0,.5);
    color: #fff;
    height: 32px;
    position: absolute;
    width: 360px;
    z-index: 1000;
}

.nsImageToolbar .nsImageToolbarButton {
    background-color: transparent;
    border-width: 0;
    color: #fff;
    cursor: pointer;
    display: block;
    float: left;
    font-size: 14px;
    height: 32px;
    text-align: center;
    width: 32px;
}

.nsImageToolbar .nsImageToolbarButton:hover {
    background-color: #0074d9;
    color: #fff;
}

.nsImageFullscreen:-webkit-full-screen,
.nsImageFullscreen:-webkit-full-screen,
.nsImageFullscreen:-ms-fullscreen{
      width: auto !important;
      height: auto !important;
      margin:auto !important;
}

.nsImageCropperOuterContainer
{
	position: relative;
    display: inline-block;
    margin: 0 auto;
	
}

.nsImageCropperOuterContainer .nsImageCropperContainer
{
	position: absolute;
	z-index: 600;
}

.nsImageCropperOuterContainer .nsImageCropperImageContainer
{
	position: absolute;
	overflow: hidden;
	z-index: 300;
	height:100%;
	width:100%;
}

.nsImageCropperOuterContainer .nsImageCropperDragContainer
{
	z-index: 310;
	height:100%;
	width:100%;
}

.nsImageCropperOuterContainer .nsImageCropperTracker
{
	position: absolute;
	z-index: 280;
	height:100%;
	width:100%;
}

.nsImageCropperOuterContainer .nsImageCropperMoveTracker
{
	z-index: 350;
	cursor: move;
}

.nsImageCropperOuterContainer .nsImageCloned
{
	border: none;
    visibility: visible;
    margin: 0;
    padding: 0;
    position: absolute;
    top: 0;
    left: 0;
}

.nsImageCropperOuterContainer .nsImageDragBar
{
	position: absolute;
}

.nsImageCropperOuterContainer .nsImageDragBar.nsImageDragBar-n
{
	height: 7px;
  	width: 100%;
  	margin-top: -4px;
  	cursor: n-resize;
}

.nsImageCropperOuterContainer .nsImageDragBar.nsImageDragBar-s
{
	height: 7px;
  	width: 100%;
  	bottom: 0;
  	margin-bottom: -4px;
  	cursor: s-resize;
}

.nsImageCropperOuterContainer .nsImageDragBar.nsImageDragBar-e
{
	height: 100%;
  	width: 7px;
  	margin-right: -4px;
  	right: 0;
  	cursor: e-resize;
}

.nsImageCropperOuterContainer .nsImageDragBar.nsImageDragBar-w
{
	height: 100%;
  	width: 7px;
  	margin-left: -4px;
  	cursor: w-resize;
}

.nsImageCropperOuterContainer .nsImageHandle
{
	position: absolute;
	background-color: #333333;
  	border: 1px #eeeeee solid;
  	width: 7px;
  	height: 7px;
  	font-size: 1px;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-n
{
	left: 50%;
  	margin-left: -4px;
  	margin-top: -4px;
  	top: 0;
  	cursor: n-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-s
{
	bottom: 0;
  	left: 50%;
  	margin-bottom: -4px;
  	margin-left: -4px;
  	cursor: s-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-e
{
	margin-right: -4px;
  	margin-top: -4px;
  	right: 0;
  	top: 50%;
  	cursor: e-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-w
{
	left: 0;
  	margin-left: -4px;
  	margin-top: -4px;
  	top: 50%;
  	cursor: w-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-nw
{
	left: 0;
  	margin-left: -4px;
  	margin-top: -4px;
  	top: 0;
  	cursor: nw-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-ne
{
	margin-right: -4px;
  	margin-top: -4px;
  	right: 0;
  	top: 0;
  	cursor: ne-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-sw
{
	bottom: 0;
  	left: 0;
  	margin-bottom: -4px;
  	margin-left: -4px;
  	cursor: sw-resize;
}

.nsImageCropperOuterContainer .nsImageHandle.nsImageHandle-se
{
	bottom: 0;
  	margin-bottom: -4px;
  	margin-right: -4px;
  	right: 0;
  	cursor: se-resize;
}

.nsImageCropperOuterContainer .nsImageBorder
{
	position: absolute;
	font-size: 0;
}

.nsImageCropperOuterContainer .nsImageBorder.nsImageBorderVertical
{
	width: 1px !important;
	height: 100%;
}

.nsImageCropperOuterContainer .nsImageBorder.nsImageBorderHorizontal
{
	height: 1px !important;
	width: 100%;
}
.nsImageCropperOuterContainer .nsImageBorder.nsImageBorderHorizontal.nsImageBorderHorizontalBottom
{
	bottom: 0;
}
.nsImageCropperOuterContainer .nsImageBorder.nsImageBorderVertical.nsImageBorderVerticalRight
{
	right: 0;
}

.nsImageMagnifierOuterContainer
{
	position: relative;
    margin: 0 auto;
}

.nsImageMagnifierResult 
{
  	border: 1px solid #d4d4d4;
}

.nsImageMagnifierLens 
{
  	position: absolute;
  	width: 40px;
  	height: 40px;
  	cursor: crosshair;
    border: 1px solid rgb(0, 0, 0);
    background-repeat: no-repeat;
    overflow: hidden;
    z-index: 999;
    opacity: 1;
    zoom: 1;
}
