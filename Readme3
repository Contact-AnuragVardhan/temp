CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter varchar(25))     
returns @temptable TABLE (counter int,items varchar(8000))     
as     
begin     
declare @idx int  
declare @counter int     
declare @slice varchar(8000)     

Set @counter = 1 ; 
select @idx = 1     
    if len(@String)<1 or @String is null  return     

while @idx!= 0     
begin     
    set @idx = charindex(@Delimiter,@String)     
    if @idx!=0   
        BEGIN    
        set @slice = left(@String,@idx - 1)          
        END
    else     
        set @slice = @String     

    if(len(@slice)>0)
    BEGIN
        insert into @temptable(counter,Items) values(@counter,@slice) 
        set @counter = @counter + 1;
        
    END        
    if(len(@String)>(@idx + len(@Delimiter) -1  ))
    BEGIN
    set @String = right(@String,len(@String) - (@idx + len(@Delimiter) -1  ))     
    END
    if len(@String) = 0 break     
end 
return     
end


Select '1,2,3' as Type into #temp1 

Select * into #temp2 
from 
(Select 1 as type,'text1' as text
Union 
Select 2 as type,'text2' as text
Union 
Select 3 as type,'text3' as text)t1

Select * from #temp1 
Select * from #temp2

Select t2.text into #temp3 from #temp1 t1
Inner Join  #temp2 t2 On t2.type in (Select items from dbo.Split(t1.Type,','))

Select * from #temp3 

SELECT STUFF((
         SELECT ',' + text
            FROM #temp3
            FOR XML PATH('')
         ), 1, 1, '')
